
<!doctype html>
 <html>
     <head>
         <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
        <script>
            AFRAME.registerComponent('model-opacity', {
                schema: {default: 1.0},
                init: function () {
                    this.el.addEventListener('model-loaded', this.update.bind(this));
                },
                update: function () {
                var mesh = this.el.getObject3D('mesh');
                var data = this.data;
                if (!mesh) { return; }
                    mesh.traverse(function (node) {
                    if (node.isMesh) {
                        node.material.opacity = data;
                        node.material.transparent = data < 1.0;
                        node.material.needsUpdate = true;
                    }
                });
            }
        });
            
            AFRAME.registerComponent('play', {
			init: function () {
				var myEl = document.querySelector('#yellow');
				this.el.addEventListener('click', function () {
					myEl.components.sound.playSound();
				});
			}
		});
		AFRAME.registerComponent('stop', {
			init: function () {
				var myEl = document.querySelector('#yellow');
				this.el.addEventListener('click', function () {
					myEl.components.sound.stopSound();
				});
			}
		});
         
         </script>
    </head>
    <body>
       <a-scene>
           <a-assets>
                <audio id="audio-1" src="audio/shrek.mp3" preload="auto"></audio>       	      
            </a-assets>
           <!--Camara-->
           <a-entity position="20 6 0">
			<a-camera>
				<a-cursor></a-cursor>
			</a-camera>
		</a-entity>
           
           <!--Escenario-->
           <img id="sky" src="Background/cielo.jpg">
           <a-asset-item id="casa" src="Casa/scene.gltf"></a-asset-item>  
           
           <!--Personajes-->
           <a-asset-item id="bichowapo" src="PersonajesSimpaticos/scary_creature/scene.gltf"></a-asset-item>  
           <a-asset-item id="person" src="PersonajesSimpaticos/person/scene.gltf"></a-asset-item>  
           <a-asset-item id="monstruo" src="PersonajesSimpaticos/the_deadly_spawn_animation/scene.gltf"></a-asset-item>
           <a-asset-item id="shrek" src="PersonajesSimpaticos/shrek_dancing/scene.gltf"></a-asset-item>

           <!--Traer escenario-->
            <a-sky src="#sky"></a-sky>
            <a-entity gltf-model="#casa"></a-entity>
           
           
           <!--Hombres con traje-->
           <a-entity rotation="-10 -80 0" gltf-model="#person" position="26.5 5.5 -16" 
           animation="property: position;
                          from: 26.5 5.5 -16;
                          to: 23 6.5 -15.5;
                          dir: alternate;
                          dur: 3000;"
                     animation_2="property: position;
                          from: 23 6.5 -15.5;
                          to: 26.5 5.5 -16;
                          dir: alternate;
                          dur: 3000;"
            animation_3="property: rotation;
                         dur:10000;
                         fill:forwards
                         to:0 90 0
                         repeat:indefinite">
           </a-entity>
           <a-entity rotation="-10 -60 0" gltf-model="#person" position="26 5.5 -19"  animation="property: position;
                          from: 26.5 5.5 -16;
                          to: 23 6.5 -15.5;
                          dur: 10000;"
                     animation_2="property: position;
                          from: 23 6.5 -15.5;
                          to: 26.5 5.5 -16;
                          dur: 3000;">
           </a-entity>
           <a-entity rotation="-10 -110 0" gltf-model="#person" position="26 5.5 -13" >
                <a-animation attribute="position"
                    dur="10000"
                    fill="forwards"
                    to="23 6.5 -15.5"
                    repeat="indefinite">
                </a-animation> 
               <a-animation attribute="rotation"
                     dur="10000"
                     fill="forwards"
                     to="0 90 0"
                     repeat="indefinite">
               </a-animation>
           </a-entity>
           
           <!--Monstruo fusionado-->
           <a-entity rotation="-10 90 0" gltf-model="#monstruo" position="23 4 -16" scale="0.5 0.5 0.5" material="opacity: 0.7;">
                <a-animation attribute="model-opacity"
               dur="10000"
               from="1"
               to="0"
               repeat="indefinite"></a-animation>
           </a-entity>
           
           <!-- Shrek bailarin -->
           
            <a-entity gltf-model="#shrek" position="35.5 4.5 -23">       
                <a-animation attribute="rotation"
                    dur="1000"
                    fill="forwards"
                    to="0 360 0"
                    repeat="indefinite"/>
           </a-entity>
           <a-box id="yellow" color="#FFAA00" position="35.5 6 -23" sound="src: #audio-1; volume: 2" scale="0.5 0.5 0.5">
			<!-- Play-->
			<a-sphere color="#00AA00" radius="0.25" position="-1 1 0" play></a-sphere> 
			<!-- Stop-->
			<a-sphere color="#AA0000" radius="0.25" position="1 1 0" stop></a-sphere>
        </a-box>                
        </a-scene>
    </body>
</html>
